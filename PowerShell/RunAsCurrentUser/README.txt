This script is not written by me, but I have used it a few times to run something in the context of a logged in user account. Credit is given to the original developer within the script.
